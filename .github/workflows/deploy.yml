name: Deploy React App to Homelab

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: [self-hosted, linux, homelab]

    steps:
      # 1. Pobieramy kod
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Instalujemy zaleÅ¼noÅ›ci (biblioteki z package.json)
      - name: Install Dependencies
        run: npm install

      # 3. Budujemy aplikacjÄ™ (To zamieni TSX na czysty HTML/JS w folderze 'dist')
      - name: Build Project
        run: npm run build

      # 4. CzyÅ›cimy folder serwera WWW
      - name: Clean Nginx Folder
        run: rm -rf /var/www/html/*

      # 5. Kopiujemy TYLKO zbudowanÄ… aplikacjÄ™ (folder dist)
      - name: Deploy to Nginx
        run: |
          echo "ðŸš€ Wgrywanie zbudowanej aplikacji..."
          # Vite domyÅ›lnie buduje do folderu 'dist'. Kopiujemy JEGO ZAWARTOÅšÄ†.
          cp -r dist/* /var/www/html/
          echo "âœ… Gotowe!"
