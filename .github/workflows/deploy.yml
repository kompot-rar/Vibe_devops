name: Deploy React App to Homelab

on:
  push:
    branches:
      - main  # Upewnij siÄ™, Å¼e Twoja gaÅ‚Ä…Åº to 'main' (czasem bywa 'master')

jobs:
  build-and-deploy:
    runs-on: [self-hosted, linux, homelab]

    steps:
      # 1. Pobranie kodu
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Diagnostyka Å›rodowiska
      - name: Check Environment
        run: |
          echo "ğŸ” Node version:"
          node -v
          echo "ğŸ” NPM version:"
          npm -v

      # 3. Instalacja zaleÅ¼noÅ›ci
      - name: Install Dependencies
        run: npm install

      # 4. Budowanie aplikacji (Vite)
      - name: Build Project
        run: npm run build

      # 5. DIAGNOSTYKA: Co powstaÅ‚o?
      - name: Debug Build Output
        run: |
          echo "ğŸ“‚ ZawartoÅ›Ä‡ folderu dist:"
          ls -R dist/ || echo "âŒ Brak folderu dist!"

      # 6. Czyszczenie serwera WWW
      - name: Clean Nginx Folder
        run: rm -rf /var/www/html/*

      # 7. Kopiowanie plikÃ³w
      - name: Deploy to Nginx
        run: |
          echo "ğŸš€ Kopiowanie plikÃ³w..."
          # Kopiujemy zawartoÅ›Ä‡ folderu dist
          cp -r dist/. /var/www/html/

      # 8. Naprawa uprawnieÅ„
      - name: Fix Permissions
        run: |
          chown -R www-data:www-data /var/www/html
          chmod -R 755 /var/www/html
          echo "âœ… Uprawnienia naprawione!"
